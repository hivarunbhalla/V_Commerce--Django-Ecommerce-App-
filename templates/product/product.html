{% extends "base/base.html" %}
{% block start %}

<section class="section-content padding-y bg">
  <div class="container">
    <div class="card">
      <div class="row no-gutters">
        <!-- Image Gallery Section -->
        <aside class="col-md-6">
          <article class="gallery-wrap">
            <div class="img-big-wrap">
              <div>
                <a href="#" id="main-image-link">
                  <img id="main-image" src="/media/{{ product.product_images.first.image }}" alt="{{ product.product_title }}" />
                </a>
              </div>
            </div>
            <!-- Thumbnail Navigation -->
            <div class="thumbs-wrap">
              {% for image in product.product_images.all %}
                <a href="#" class="item-thumb" data-image="/media/{{ image.image }}">
                  <img src="/media/{{ image.image }}" alt="Thumbnail Image" />
                </a>
              {% endfor %}
            </div>
          </article>
        </aside>
        
        <!-- Product Details Section -->
        <main class="col-md-6 border-left">
          <article class="content-body">
            <!-- Product Title -->
            <h2 class="title">{{ product.product_title }}</h2>
            
            <!-- Product Rating -->
            {% include "components/reviews/rating.html" %}
            
            <!-- Product Price -->
            <div class="mb-3">
              <var class="price h4">$<span id="product-price">{{ variant_price }}</span></var>
            </div>
            
            <!-- Product Description -->
            {% if product.product_description %}
              <p>{{ product.product_description }}</p>
            {% endif %}
            
            <hr />
            
            <!-- Variant Selection -->
            <div class="form-row">
              <!-- Quantity Picker -->
              <div class="form-group col-md flex-grow-10">
                {% include "components/products/quantity_picker.html" %}
              </div>
              
              <!-- Size Variants -->
              {% if size_variants %}
                {% include "components/products/size_varients.html" %}
              {% endif %}
                
            </div>
            
              
            <!-- Action Buttons -->
            <div class = "axtion-buttons button">
            {% include "components/buttons/buy_now.html" %}
            {% include "components/buttons/add_to_cart.html" %}
            </div> 

          </article>
        </main>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Image gallery functionality
  const mainImage = document.getElementById('main-image');
  const mainImageLink = document.getElementById('main-image-link');
  const thumbnails = document.querySelectorAll('.item-thumb');

  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function(e) {
      e.preventDefault();
      const newImageSrc = this.getAttribute('data-image');
      mainImage.src = newImageSrc;
      mainImageLink.href = newImageSrc;
    });
  });

  // Variant selection and price update
  const variantSelects = document.querySelectorAll('.variant-select');
  const priceElement = document.getElementById('product-price');

  variantSelects.forEach(select => {
    select.addEventListener('change', function() {
      updatePrice();
    });
  });

  function updatePrice() {
    const selectedColor = document.querySelector('input[name="select_color"]:checked');
    const selectedSize = document.querySelector('input[name="select_size"]:checked');

    const color = selectedColor ? selectedColor.value : '';
    const size = selectedSize ? selectedSize.value : '';

    fetch(`?color=${color}&size=${size}`, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    })
    .then(response => response.json())
    .then(data => {
      priceElement.textContent = data.price.toFixed(2);
    });
  }

  // Trigger initial price update
  updatePrice();
});
</script>

{% endblock %}